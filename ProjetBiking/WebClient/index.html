<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css" type="text/css">
    <style>
      .map {
        height: 800px;
        width: 100%;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
    <title>OpenLayers example</title>
  </head>
  <body>
  <div>
     <h2>My Map</h2>
	<input type="button" value="Centrer sur Nantes" value="">
  <div id="Adress block">
    <h2>Or give the adress of your destination</h2>
    <label for="adress">Address Start :</label>
    <input name="adressInput" id="address">
    <label for="adress2">Address End :</label>
    <input name="adressInput2" id="address2">
    <label for="city"> City :</label>
    <input name="cityInput" id="city">
    <button id="retrieveStationsAndItinaries" onclick="searchAddress();">Search</button>
  </div>
  <div/>
    <div id="map" class="map"></div>
    <script type="text/javascript">
    function searchAddress() {
        let address = encodeURI(document.getElementById("address").value)
        let address2 = encodeURI(document.getElementById("address2").value)
        let city = encodeURI(document.getElementById("city").value)
        console.log(address);
        console.log(address2);
        console.log(city);
        var url = "http://localhost:8733/Design_Time_Addresses/Server/Services/rest/GetItinary/"+address+"/"+address2+"/"+city

        var requestType = "GET";
        var caller = new XMLHttpRequest();
        caller.open(requestType, url, true);
        caller.setRequestHeader ("Accept", "application/json");
        caller.onload=manageResult;
        caller.send();
    }
    function manageResult(){
      // drawLine(,'green');
      var response = JSON.parse(this.responseText);
      console.log(response);
      console.log(response[0].features[0].properties.segments[0].distance);
      console.log(response[0].features[0].properties.segments[0].distance);
      console.log(response[1].features[0].properties.segments[0].distance);
      console.log(response[2].features[0].properties.segments[0].distance);
      drawLine(response[0],"orange");
      drawLine(response[1],"green");
      drawLine(response[2],"orange");
    }
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([1.462036545748826, 43.60487801573529]),
          zoom: 11
        })
      });
      function drawLine(route, color){
        var coords = route.features[0].geometry.coordinates;
        var lineString = new ol.geom.LineString(coords);
        lineString.transform('EPSG:4326', 'EPSG:3857');

        var feature = new ol.Feature({
          geometry: lineString,
          name: 'Line'
        });
        var lineStyle = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: color,
            width: 10
          })
        })
        var source = new ol.source.Vector({
        features: [feature]
        });

        var vector = new ol.layer.Vector({
            source: source,
            style: [lineStyle]
        });

        map.addLayer(vector);
        console.log("C FINI");
      }
    </script>
  </body>
</html>